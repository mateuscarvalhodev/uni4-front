<section class="page">
  <header class="page__header">
    <h2>{{ isEdit() ? 'Editar usuário' : 'Novo usuário' }}</h2>
    <a class="btn btn--ghost" routerLink="/app/users">Voltar</a>
  </header>

  <div class="card">
    <form [formGroup]="form" (ngSubmit)="save()" class="form" novalidate>
      @if (error()) {
      <div class="errbox">{{ error() }}</div>
      }

      <div class="field">
        <label for="name">Nome</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          placeholder="Nome completo"
          [attr.aria-invalid]="form.controls.name.invalid && form.controls.name.touched"
          [attr.aria-describedby]="form.controls.name.invalid ? 'name-err' : null"
          required
        />
        @if (form.controls.name.touched && form.controls.name.invalid) {
        <div id="name-err" class="err">Informe o nome.</div>
        }
      </div>

      <div class="field">
        <label for="email">Email</label>
        <input
          id="email"
          type="email"
          formControlName="email"
          placeholder="email@uni4.dev"
          [attr.aria-invalid]="form.controls.email.invalid && form.controls.email.touched"
          [attr.aria-describedby]="form.controls.email.invalid ? 'email-err' : null"
          required
        />
        @if (form.controls.email.touched && form.controls.email.invalid) {
        <div id="email-err" class="err">Informe um email válido.</div>
        }
      </div>

      <div class="field">
        <label for="username">Username</label>
        <input
          id="username"
          type="text"
          formControlName="username"
          placeholder="ex.: joaosilva"
          [attr.aria-invalid]="form.controls.username.invalid && form.controls.username.touched"
          [attr.aria-describedby]="form.controls.username.invalid ? 'username-err' : null"
          required
        />
        @if (form.controls.username.touched && form.controls.username.invalid) {
        <div id="username-err" class="err">Informe um username.</div>
        }
      </div>

      @if (!isEdit()) {
      <div class="field">
        <label for="password">Senha</label>
        <input
          id="password"
          type="password"
          formControlName="password"
          placeholder="mín. 6 caracteres"
          [attr.aria-invalid]="form.controls.password.invalid && form.controls.password.touched"
          [attr.aria-describedby]="form.controls.password.invalid ? 'pass-err' : null"
          required
        />
        @if (form.controls.password.touched && form.controls.password.invalid) {
        <div id="pass-err" class="err">Informe uma senha válida.</div>
        }
      </div>
      }

      <div class="field">
        <label for="role">Papel</label>
        <select
          id="role"
          formControlName="role"
          [attr.aria-invalid]="form.controls.role.invalid && form.controls.role.touched"
          [attr.aria-describedby]="form.controls.role.invalid ? 'role-err' : null"
          required
        >
          <option [ngValue]="''" disabled>Selecione...</option>
          @for (r of roles; track r) {
          <option [value]="r">{{ r }}</option>
          }
        </select>
        @if (form.controls.role.touched && form.controls.role.invalid) {
        <div id="role-err" class="err">Selecione um papel.</div>
        }
      </div>

      <div class="actions">
        <a class="btn btn--ghost" routerLink="/app/users">Cancelar</a>
        <button class="btn btn--primary" [disabled]="form.invalid || saving()">
          {{ isEdit() ? 'Salvar alterações' : 'Criar usuário' }}
        </button>
      </div>
    </form>
  </div>
</section>
